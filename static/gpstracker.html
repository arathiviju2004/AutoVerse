<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
    
    /* Styling the container for distance and fare */
    #distanceFareContainer {
        background-color: #fff7d6; /* Light yellow background */
        border: 3px solid #f5cc0c; /* Bright yellow border */
        border-radius: 12px; /* Rounded corners */
        padding: 20px; /* Inner spacing */
        text-align: center; /* Center-align content */
        width: 300px; /* Box width */
        margin: 20px auto; /* Center the box horizontally */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Shadow for depth */
        font-family: "Arial", sans-serif; /* Clean and modern font */
        display: inline-block; /* Make it inline for alignment with the button */
    }

    /* Styling the text inside */
    #distance, #fare {
        font-size: 2rem; /* Larger font size */
        font-weight: bold; /* Bold for emphasis */
        color: #333; /* Dark gray for contrast */
    }

    #distanceFareContainer p {
        margin: 10px 0; /* Space between lines */
        font-size: 1.2rem; /* Subtitle text size */
        color: #555; /* Slightly darker text */
    }

    /* Styling the emergency alert button */
    #emergencyBtn {
        background-color: #ff0000; /* Bright red background */
        color: #fff; /* White text */
        border: none; /* Remove default border */
        border-radius: 50%; /* Circular button */
        font-size: 1.5rem; /* Button text size */
        font-weight: bold; /* Bold text */
        padding: 20px; /* Space inside the button */
        width: 100px; /* Width for perfect circle */
        height: 100px; /* Height for perfect circle */
        text-align: center; /* Center-align text */
        cursor: pointer; /* Pointer cursor on hover */
        margin-left: 20px; /* Space between the box and button */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Shadow for depth */
    }

    /* Button hover effect */
    #emergencyBtn:hover {
        background-color: #cc0000; /* Darker red on hover */
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.3); /* Slightly deeper shadow */
    }



        #map { height: 500px; }
        button { margin: 10px; }
    </style>
</head>
<body>
    <div id="map"></div>
    <button id="stopBtn">Stop Tracking</button>
    <div style="text-align: center;"> <!-- Centering both the box and button -->
        <div id="distanceFareContainer">
            <p>Distance Traveled: <span id="distance">0</span> km</p>
            <p>Fare: ₹<span id="fare">0</span></p>
        </div>
        <button id="emergencyBtn" onclick="handleEmergency()">Alert</button>
    </div>

    <div id="ratingContainer" style="text-align: center; margin-top: 20px; display: none;">
        <p style="font-family: Arial, sans-serif; font-size: 1.2rem;">Rate Your Ride</p>
        <div id="stars" style="font-size: 3rem; color: #ccc; cursor: pointer; display: inline-flex; gap: 10px;">
            <!-- Stars will be dynamically generated by JavaScript -->
        </div>
    </div>
    
    
    
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        const map = L.map("map").setView([0, 0], 13); // Default coordinates (0, 0)

        // Load OpenStreetMap tiles
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19,
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Marker for the vehicle location
        const vehicleMarker = L.marker([0, 0]).addTo(map);

        let watchId = null;  // To store the watchPosition ID
        let lastLat = 0;
        let lastLng = 0;
        let totalDistance = 0; // Total distance traveled (in meters)
        
        // Function to calculate distance between two coordinates (in kilometers)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of Earth in kilometers
            const dLat = (lat2 - lat1) * (Math.PI / 180);
            const dLon = (lon2 - lon1) * (Math.PI / 180);
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * (Math.PI / 180)) *
                    Math.cos(lat2 * (Math.PI / 180)) *
                    Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const distance = R * c; // Distance in kilometers
            return distance;
        }

        // Function to update the map with GPS location
        function updateLocation(lat, lng) {
            vehicleMarker.setLatLng([lat, lng]);
            map.setView([lat, lng], 13); // Zoom in to the current location

            // If we have a previous position, calculate the distance
            if (lastLat !== 0 && lastLng !== 0) {
                const distance = calculateDistance(lastLat, lastLng, lat, lng);
                totalDistance += distance;
                document.getElementById("distance").innerText = (totalDistance).toFixed(2);
                document.getElementById("fare").innerText = (calculateFare(totalDistance)).toFixed(2);
            }

            // Update the last known position
            lastLat = lat;
            lastLng = lng;
        }

        // Function to calculate fare based on the total distance
        function calculateFare(distance) {
            let fare = 30;  // Base fare for the first 1.5 kilometers
            if (distance > 1.5) {
                fare += (distance - 1.5) * 15;  // ₹15 for each km after 1.5 km
                const extraDistance = distance - 1.5;
                fare += (extraDistance * 1000 % 100) * 1.5; // ₹1.50 for every 100 meters
            }
            return fare;
        }

        // Check if the browser supports Geolocation
        function startTracking() {
            if ("geolocation" in navigator) {
                watchId = navigator.geolocation.watchPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        updateLocation(latitude, longitude);
                    },
                    (error) => {
                        console.error("Error getting GPS location:", error.message);
                    },
                    {
                        enableHighAccuracy: true,
                        maximumAge: 10000,
                        timeout: 10000
                    }
                );

                // Disable the stop button
                document.getElementById("stopBtn").disabled = false;
            } else {
                alert("Geolocation is not supported by your browser.");
            }
        }

        function stopTracking() {
            if (watchId !== null) {
                navigator.geolocation.clearWatch(watchId);
            }

            // Disable the stop button
            document.getElementById("stopBtn").disabled = true;
        }

        // Start tracking automatically on page load
        window.onload = startTracking;

        // Event listener for the stop button
        document.getElementById("stopBtn").addEventListener("click", stopTracking);

        function handleEmergency() {
        alert("Emergency Alert Triggered!");
        // Add additional emergency handling logic here, e.g., API call, SMS alert, etc.
    }

    // Function to handle star rating interaction
    // Function to handle star rating interaction
function setupStarRating() {
    const starsContainer = document.getElementById("stars");
    starsContainer.innerHTML = ""; // Clear existing stars if any
    let selectedRating = 0;

    // Create 5 stars dynamically
    for (let i = 1; i <= 5; i++) {
        const star = document.createElement("span");
        star.textContent = "★"; // Add star
        star.dataset.star = i; // Set star value
        star.style.color = "#ccc"; // Default color
        star.style.transition = "color 0.2s ease-in-out"; // Smooth color change

        // Hover effect
        star.addEventListener("mouseover", () => {
            for (let j = 0; j < 5; j++) {
                starsContainer.children[j].style.color = j < i ? "#FFD700" : "#ccc";
            }
        });

        // Click effect to select rating
        star.addEventListener("click", () => {
            selectedRating = i;
            alert(`You rated this ride ${selectedRating} star(s)!`);
        });

        // Reset to selected rating when mouse leaves
        starsContainer.addEventListener("mouseleave", () => {
            for (let j = 0; j < 5; j++) {
                starsContainer.children[j].style.color = j < selectedRating ? "#FFD700" : "#ccc";
            }
        });

        // Add the star to the container
        starsContainer.appendChild(star);
    }
}

// Display the star rating after stopping the tracking
function stopTracking() {
    if (watchId !== null) {
        navigator.geolocation.clearWatch(watchId);
    }

    // Disable the stop button
    document.getElementById("stopBtn").disabled = true;

    // Show the rating container
    document.getElementById("ratingContainer").style.display = "block";

    // Initialize star rating interaction
    setupStarRating();
}


    </script>
</body>
</html>



